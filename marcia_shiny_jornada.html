<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Shiny para comunicação estatística</title>
    <meta charset="utf-8" />
    <meta name="author" content="Slides baseados no material das Ladies Jessica Minnier, Érica Castilho e Alison Presmanes Hill" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Shiny para comunicação estatística
## Jornada de Matemática e Estatística
### Slides baseados no material das Ladies Jessica Minnier, Érica Castilho e Alison Presmanes Hill
### 16 de outubro, 2019

---




class: center, middle


# Por que Shiny?


---

background-image: url("https://media.giphy.com/media/c3MEOYK3O8POo/giphy.gif")
background-position: 50% 50%
class: center, inverse


---

background-image: url(figs/spreadsheetcombo.png)
background-position: center;

class: middle, center

# Motivação

## Muitas tabelas que precisam ser representadas!!

---

## Motivação

&lt;font style="color: darkorange;"&gt;"Você pode fazer mais um gráfico? Obrigada! Mas, agora preciso de mais um gráfico, acho que pode ter uma relação diferente só com esse grupo de observações. Ok, mas precisava de mais uma análise, pode ser? Ah agora sim acho que acabou a análise, mas peraí, acho que preciso de mais um, adivinha, gráfico? Análise? Filtro de observações, ..."&lt;/font&gt;

&lt;img src="figs/heatmap_start.png"&gt;&lt;/img&gt;

---

background-image: url("https://media.giphy.com/media/TseBjMu53JgWc/giphy.gif")
background-position: 50% 50%
class: center, inverse

---


background-image: url(figs/toomanyplots.png)
background-repeat: repeat-x;


# Você pode fazer mais um gráfico? O problema dessa pergunta é que:

---

background-image: url(figs/toomanyplots.png)
background-repeat: repeat-x;


# Você pode fazer mais um gráfico? O problema dessa pergunta é que:


# dependendo do banco há infinitas possibilidades e combinações de variáveis ou/e de filtros.

---


# Como resolver isso? 

--

background-image: url(figs/shinyhex.png)
background-position: 50% 50%
background-size: 50%


---

# Minha motivação

### Núcleo de Avaliação da Unidade (NAU): representar diferentes combinações possíveis de variáveis de avaliação  &lt;font style="color: darkorange;"&gt;one data set&lt;/font&gt;

- &lt;font style="color: darkorange;"&gt; Explorar, visualizar, divulgar&lt;/font&gt;
- Especificar uma pergunta do questionário ou considerar somente alunos da estatística, matemática, outros cursos, ...  

---

# Minha motivação


### Datathon

&lt;img src="figs/banner_dthon.jpg"&gt;&lt;/img&gt;


---

class: middle, center, inverse

# Motivação de todos:



## Divulgação!

--

## Interatividade entre o usuário! 

--

## Pode ser que precisemos focar em variáveis específicas, ou em grupo de observações, com o shiny podemos juntar todas as possibilidades!!! 


---

#  *Collaborator:* "Como posso compartilhar os meus dados"

--

&lt;a href="https://kcvi.shinyapps.io/START_HT/"&gt;&lt;img src="figs/shinyapp_ht.png"&gt;&lt;/img&gt;&lt;/a&gt;
---


# *Estatísticos/Cientistas de dados*: &lt;br&gt;"Como fazer as pessoas utilizarem a metodologia que eu criei ou o meu pacote?"

--

&lt;a href="http://qvalue.princeton.edu/"&gt;&lt;img src="figs/qvalue.png"&gt;&lt;/img&gt;&lt;/a&gt;

---

# *Estatísticos/Cientistas de dados*: &lt;br&gt; Olhe a análise que eu fiz!!

--

&lt;a href="https://gallery.shinyapps.io/TSupplyDemand/"&gt;&lt;img src="figs/phillyschools.png"&gt;&lt;/img&gt;&lt;/a&gt;


---

# *Estatísticos/Cientistas de dados*: &lt;br&gt; Visualização em mapas!

--

&lt;a href="https://gallery.shinyapps.io/"&gt;&lt;img src="figs/mapa_shiny.png"&gt;&lt;/img&gt;&lt;/a&gt;


---

# *Ensinar R e estatística! (`learnr`)

--

&lt;a href="https://minnier.shinyapps.io/ODSI_continuousData/"&gt;&lt;img src="figs/learnr.png"&gt;&lt;/img&gt;&lt;/a&gt;

---

# Resumindo;

## O que é Shiny:

* Pacote do R.

* Permite criar apps interativos.

* Esses apps podem ficar disponíveis no seu usuário na página do shiny.io.

* Podem ser inseridos em arquivos R Markdown

## Uma ótima ferramenta para apresentar resultados de qualquer análise de dados.

---

# Cursos on-line: 

## Datacamp

## Rstudio

# Vários exemplos disponíveis

### &lt;https://gallery.shinyapps.io/LDAelife/&gt;

### &lt;http://www.dataseries.org/&gt;

### &lt;https://www.showmeshiny.com/&gt;



---

# COMEÇANDO PELO COMEÇO...

* É necessário já ter uma certa habilidade com o R.
* O Shiny possui sua lógica própria.
* Todos gráficos e análises realizadas no R podem se incluídas dentro do seu App.
* Como eu comecei?

--
* Editando os apps que encontrava online.

--
* Esse é o caminho mais longo.
* Não entende a lógica e faz o código na força bruta.
* Como eu recomendo?
* Entenda lógica das funções.

---

# COMPONENTES DO APLICATIVO

## Todo o aplicativo tem dois componentes:

### ui.r e server.R

---

# ui.r


### Aqui é onde está a interface com o usário.

### Onde podemos escolher o filtro, tamanho de amostra, gráfico ...

### Título, como as informações serão apresentadas, o que será apresentado.

###  O R cria um arquivo Html a partir do seu código.


---

# server.r

### Instruções para o servidor.

### Nessa parte você coloca todo seu código.

### Suas análises, a construção dos gráficos, etc.

### O servidor vai fazer tudo sozinho a partir das suas instruções e ele vai interagir com o usuário.

### Aqui está o coração do seu código.

---

# App.R

### É possível colocar as duas componentes ui.R e server.R em um único arquivo o app.R

### Isso pode ser um problema dependendo do tamanho do seu código

### Seu código vai crescendo à medida que vai acrescentando mais ferramentas, o programa pode ficar muito grande e fica mais complicado de descobrir erros.


---

# Estrutura básica do arquivo ui.R


```r
ui &lt;- fluidPage(
  # *Input() functions;
  # *Output() functions
)
```

---
# Estrutura básica do arquivo ui.R
## Input

* Funções de entrada dos dados.
* Vão depender do tipo de informação você precisa coletar.
* Usuário vai digitar um número? 



```r
numericInput(inputId, label, value, min=NA, max=NA, step=NA, width = NULL)
```

* _inputId_ é o nome da variável no seu código.
* _label_ é o nome que vai aparecer para o usuário
* _value_ o valor usado antes do usuário digitar qualquer valor ( é sempre necessário)
* _Opcionais_: 

* min, max faixa de valores permitidos 
* step se não quiser permitir números quebrados 
* width é a largura da caixa

---

## Input

O usuário vai selecionar uma opção?



```r
selectInput(inputId, label, choices, selected = NULL, multiple = FALSE, selectize = TRUE, width = NULL, size = NULL)
```

* inputId é o nome da variável no seu código.

* label é o nome que vai aparecer para o usuário

* choices as opções que ele terá (Masculino, Feminino)

* Opcionais: selected a opção selecionada por default (considera a primeira se deixar em branco) 

* _multiple_ permite selecionar mais de uma opção

---

# Exemplo: 


&lt;a href="http://shiny.rstudio.com/gallery/kmeans-example.html"&gt;&lt;img src="figs/k_means.png"&gt;&lt;/img&gt;&lt;/a&gt;


---

# Outras opções de layout: 


&lt;a href="https://shiny.rstudio.com/gallery/widget-gallery.html"&gt;&lt;img src="figs/outras_opcoes.png"&gt;&lt;/img&gt;&lt;/a&gt;

---


# Output()


* Funções de saída dos dados.

* Podem ser o resultado de qualquer tipo de análise.

* Gráficos, tabelas, figuras, textos, mapas, etc.


&lt;img src="figs/output_tabela.png"&gt;&lt;/img&gt;

---

### A função deve ser inserida no arquivo ui.R

&lt;img src="figs/plot_output.png"&gt;&lt;/img&gt;



---

# Exemplo: 



```r
ui = fluidPage(
  sliderInput(inputId = "num",
              label = "escolha um numero",
              value = 30, min = 1, max = 100),
  plotOutput("hist")
)

server = function(input, output) {}

shinyApp(ui = ui, server = server)
```

---

# Exemplo:

### Resultado da função anterior

&lt;img src="figs/hist_nao_server.png"&gt;&lt;/img&gt;


---

# Exemplo: 


* Vamos definir o que é o objeto hist.
* Isso será feito no arquivo server.r
* O formato de saída é output$nome_objeto



```r
server = function(input, output){
  output$hist = #code
}
```

---

# Exemplo: 


* Para que o objeto de saída seja atualizado de acordo com as entradas ele tem que ser reativo
* Ele deve ser uma função do tipo render.
* Caso contrário ele é estático e não pode depender do input



```r
server = function(input, output){
  output$hist = renderPlot({
    
  })
}
```

---

# Exemplo:

* As funções do tipo render acompanham os tipos de output

&lt;img src="figs/output2.png"&gt;&lt;/img&gt;

---
# Exemplo:

* Vamos fazer um histograma de uma amostra de uma normal padrão de tamanho 100.


```r
renderPlot({hist(rnorm(100))
  })
```

* `renderPlot` é o tipo de objeto

* `hist` é o código que constroi o objeto

---

# Exemplo:



```r
server = function(input, output){
  output$hist = renderPlot({
    title = "amostra aleatoria de uma normal de tamanho 100",
    hist(rnorm(100)), main=title
    
  })
}
```

---

# Exemplo:

* No exemplo anterior não usamos o input() na função.
* Vamos supor que o tamanho da amostra não será fixo em 100.
* O usuário vai determinar o tamanho da amostra.
* Esse valor estará salvo no objeto “num”



```r
sliderInput(inputId = "num", ...)

#input$num
```

---

# Exemplo:

* Esse valor vai ser atualizado de acordo com o que o usuário escolher.

&lt;img src="figs/input_num.png"&gt;&lt;/img&gt;


---
# Exemplo:

* Esse valor agora será usado para definir o tamanho da amostra.



```r
server = function(input, output){
  output$hist = renderPlot({
    hist(rnorm(input$num))
    
  })
}
```

---

# Exemplo:

### Resultado

* Se modificar o valor escolhido o gráfico atualiza automaticamente (e rapidamente se o processamento no arquivo server não for demorado!)


&lt;img src="figs/histograma.png"&gt;&lt;/img&gt;



---



# Shiny: básico


```r
# what you see, client side
ui &lt;- fluidPage(
  

)
```


```r
# Cálculos aqui!
server &lt;- function(input, output) {
  
  
  
  
}
```



```r
# run the app!
shinyApp(ui = ui, server = server)
```


---
# Shiny 


```r
# what you see, client side
ui &lt;- fluidPage(
  # Title, panels
  plotOutput("myplot"), #from output$myplot
  selectInput("foo",choices=allthechoices)
)
```


```r
# computations here!
server &lt;- function(input, output) {
  
  
  
  
}
```



```r
# run the app!
shinyApp(ui = ui, server = server)
```

---
# Shiny 


```r
# what you see, client side
ui &lt;- fluidPage(
  # Title, panels
  plotOutput("myplot"), #from output$myplot
  selectInput("foo",choices=allthechoices)
)
```


```r
# computations here!
server &lt;- function(input, output) {
  # reactive plots
  output$myplot &lt;- renderPlot({ ggplot(yay) + geom_point() })
  # use input$foo here, maybe observe changes in UI
  observe({ dostuff(input$foo) })
}
```



```r
# run the app!
shinyApp(ui = ui, server = server)
```

---

https://github.com/rladies/rshinylady


---

# Como colocar seu App on-line

1. Crie uma conta no http://www.shinyapps.io/

2. Rode o app na sua máquina e clique em Publish


---

background-position: 50% 50%
class: center, inverse, middle


# Dicas: 

* Você só consegue colocar online no máximo 5 apps por conta.

* Aplicativo tem um limites de horas.

* Se tem vários clientes que vão ficar horas olhando os resultados vai precisar de uma conta paga.

* Você pode pagar só um mês.



---

background-position: 50% 50%
class: center, inverse, middle


# Dica: 

* Todas as bases de dados usadas devem ser copiadas para a pasta do seu app. 

* Não é possível trabalhar com palavras acentuadas nos NOMES DOS ARQUIVOS.

* É possível utilizar textos e legendas com acentos, pois todos arquivos devem ter codificação UTF-8.


---

background-position: 50% 50%
class: center, inverse, middle


# Dica: se sua base de dados é muito grande, ou a análise leva muito tempo (máxima verossimilhaná por exemplo), salve as bases pré-processadas. Como o aplicativo no site do shiny faz tudo em tempo real, pode levar muito tempo para abrir os resultados.

---

# Um exemplo: app START

&lt;font style="color: darkorange;font-weight: bold;"&gt;S&lt;/font&gt;hiny 
&lt;font style="color: darkorange;font-weight: bold;"&gt;T&lt;/font&gt;ranscriptome
&lt;font style="color: darkorange;font-weight: bold;"&gt;A&lt;/font&gt;nalysis
&lt;font style="color: darkorange;font-weight: bold;"&gt;R&lt;/font&gt;esource
&lt;font style="color: darkorange;font-weight: bold;"&gt;T&lt;/font&gt;ool
&lt;br&gt;

Github: [https://github.com/jminnier/STARTapp](github.com/jminnier)
&lt;br&gt;

&lt;font style="color: green;"&gt;
DATA = &lt;em&gt;RNA-seq gene expression&lt;/em&gt;
&lt;/font&gt;

&lt;a href="https://github.com/jminnier/STARTapp"&gt;&lt;img src="figs/spreadsheet_annotated.png"/&gt;&lt;/a&gt;

---

# Tour muito rápido

&lt;iframe src="https://kcvi.shinyapps.io/START_HT/" width="100%" height="500px"&gt;&lt;/iframe&gt;

---

# Tour muito rápido

&lt;img src="figs/screencast3.gif" /&gt;

&lt;!--- https://gist.github.com/dergachev/4627207 for screencast to gif ---&gt;


---

# Distribuição dos dados, interatividade

![start_boxplot](figs/start_boxplots.png)

---

# Análise de resultados, interatividade

![start_volcano](figs/start_volcano.png)

---

# Análise exploratória, interatividade

![start_scatter](figs/start_scatterplot.png)

---
class: inverse, middle, center

# Considerações

---

# Importante saber quais serão os usuários do aplicativo!

## Exemplo: START app

- provavelmente biólogos
- o aplicativo não pode ser usado para codificação ou grandes conjuntos de dados

&lt;img src="figs/noun_1067136_cc.png" width="300px"&gt;&lt;/img&gt;
---

# Desafios: 

Fazer que a busca seja interativa  &lt;/font&gt; boxes/filtros + &lt;font style="color: darkorange;"&gt;Reactive visualization&lt;/font&gt;

&lt;img src="figs/start_search.gif" /&gt;


---



# Landing page - Onde eu estou?

- &lt;font style="color: darkorange;"&gt;Mostra&lt;/font&gt; o que o app podefazer

Bonus: [Jasmine Dumas](https://jasdumas.github.io/) has a [`shinyLP`](https://github.com/jasdumas/shinyLP) package to help!
&lt;img src="figs/shinylp.jpg"&gt;&lt;/img&gt;

---

# Novos métodos são úteis

`runApp(..., display.mode="showcase")`

Mas, não mostram porque alguma coisa não funciona.

&lt;img src="figs/start_showcase.png"&gt;&lt;/img&gt;


---


# Mais dicas

- Teste primeiro
    + Testar o aplicativo antes de disponibilizá-lo pode poupar muita dor de cabeça (packages: [`testthat`](http://testthat.r-lib.org/), [`shinytest`](https://rstudio.github.io/shinytest/))
    + Se o aplicativo precisar do upload de um banco de dados, execute testes com diferentes bancos
    + Crie arquivo .Md de plots
- Segurança
    + Os usuários estão carregando dados confidenciais?
    + Análise de segurança de aplicativos públicos versus versão comercial
- Velocidade: [Por que tão lento?](https://support.rstudio.com/hc/en-us/articles/115000171848-Why-are-my-Shiny-apps-are-running-slowly-)
     Rprofiler no Rstudio
    + Reduzir o tempo de inicialização
    + Ferramentas mais recentes: pacotes `future` e ` promises` para [programação paralela](https://medium.com/@joe.cheng/an-informal-intro-to-async-shiny-cbf01c85c4c5)

---

# Seja criativo!

[papr by Lucy D'Agostino McGowan, Nick Strayer, Jeff Leek](https://jhubiostatistics.shinyapps.io/papr/)
&lt;a href="https://jhubiostatistics.shinyapps.io/papr/"&gt;&lt;img src="figs/papr.png"&gt;&lt;/img&gt;&lt;/a&gt;

---

# Divirta-se! 

[homebrewR by David Stephens](https://davesteps.shinyapps.io/homebrewR/)
&lt;a href="https://davesteps.shinyapps.io/homebrewR/"&gt;&lt;img src="figs/homebrewr.png"&gt;&lt;/img&gt;&lt;a&gt;

---

background-image: url("https://media.giphy.com/media/UqjSzv18agbgk/giphy.gif")
background-position: 50% 50%
class: center, inverse



---

background-position: 50% 50%
class: center, inverse, middle


# Obrigada!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
